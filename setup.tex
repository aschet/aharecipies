\usepackage{scrlayer-scrpage}
\usepackage[utf8]{inputenc}
\usepackage[american]{babel}
\usepackage[pass]{geometry}
\usepackage[regular,condensed,sfdefault]{roboto}
\usepackage[T1]{fontenc}
\usepackage{fp}
\usepackage{xcolor}
\usepackage{mdframed}
\usepackage{colortbl}
\usepackage{graphicx}
\usepackage{tabu}
\usepackage{booktabs}
\usepackage[version=4]{mhchem}
\usepackage{xifthen}
\usepackage{imakeidx}
\usepackage[hidelinks,pdfencoding=auto,pdftex,
  pdfauthor={Thomas Ascher},
  pdfusetitle,
  pdfkeywords={beer, brewing, recipes}]{hyperref}
\usepackage{multicol}
\usepackage{microtype}

\KOMAoptions{toc=flat,toc=listof}

\addtokomafont{part}{\Huge}
\addtokomafont{chapter}{\Huge}
\addtokomafont{section}{\Huge}

\definecolor{softgray}{HTML}{F1F1F1}
\definecolor{hardgray}{HTML}{6A6A6A}
\chead{}
\setlength{\parindent}{0mm} 
\RedeclareSectionCommand[tocnumwidth=0.85cm]{part}

\newmdenv[linewidth=3pt,
linecolor=black,
backgroundcolor=softgray,
fontcolor=hardgray,
rightline=false,
leftline=false,
bottomline=false,
skipabove=1mm,
skipbelow=1.5mm]{recipeframe}

\newcommand{\stylecategory}[1]{\part{#1}}
\newcommand{\stylesection}[1]{\chapter{#1} \clearpage}

\newenvironment{recipe}[2][]{\begin{multicols}{2}[\section*{#2}]\ifthenelse{\equal{#1}{}}{\index{#2}}{\index{#1@#2}}}{\end{multicols} \newpage}

\newcommand{\recipebreak}{\vfill\null \columnbreak}

\newenvironment{recipeblock}[1]
{\uppercase{\textbf{#1}} \begin{recipeframe}}{\end{recipeframe}}

\newenvironment{aboutblock}
{\begin{recipeblock}{About This Recipe}}{\end{recipeblock}}

\newenvironment{ingredientsblock}
{\begin{recipeblock}{Ingredients}}{\end{recipeblock}}

\newcommand{\recipesection}[2]{
\begin{minipage}[t][1.2cm]{\textwidth}
	\begin{minipage}[c][1.2cm][c]{0.95cm}
		\includegraphics[width=0.8cm]{#1}
	\end{minipage}
	\begin{minipage}[c][1.2cm][c]{5cm}
		\large{\textcolor{black}{\uppercase{\textbf{#2}}}}
	\end{minipage}
	\hfill
\end{minipage}
}

\newcommand{\kgtokg}[1]{#1 ~kg}
\newcommand{\gtog}[1]{#1 ~g}
\newcommand{\ppmtopptm}[1]{#1 ~ppm}
\newcommand{\mltoml}[1]{#1 ~ml}
\newcommand{\ltol}[1]{#1 ~l}
\newcommand{\ptop}[1]{#1 ~°P}
\newcommand{\ctoc}[1]{#1 ~°C}
\newcommand{\ibutoibu}[1]{\FPeval\amountg{round((#1):0)}\FPprint\amountg ~IBU}
\newcommand{\psitobar}[1]{\FPeval\amountg{round((#1 * 0.0689476):1)}\FPprint\amountg ~bar}
\newcommand{\ftoc}[1]{\FPeval\amountg{round(((#1 - 32.0) / 1.8):0)}\FPprint\amountg ~°C}
\newcommand{\gpgaltogpl}[1]{\FPeval\amountg{round((#1 * 0.264172):1)}\FPprint\amountg ~g/l}
\newcommand{\ozpgaltogpl}[1]{\FPeval\amountg{round((#1 * 7.48915):1)}\FPprint\amountg ~g/l}
\newcommand{\tsptog}[1]{\FPeval\amountg{round((#1 * 4.92892):0)}\FPprint\amountg ~g}
\newcommand{\tbsptog}[1]{\FPeval\amountg{round((#1 * 15.0):0)}\FPprint\amountg ~g}
\newcommand{\oztog}[1]{\FPeval\amountg{round((#1 * 28.34952):0)}\FPprint\amountg ~g}
\newcommand{\oztokg}[1]{\FPeval\amountg{round((#1 * 0.02834952):2)}\FPprint\amountg ~kg}
\newcommand{\lbtokg}[1]{\FPeval\amountg{round((#1 * 0.4535924):2)}\FPprint\amountg ~kg}
\newcommand{\galtol}[1]{\FPeval\amountg{round((#1 * 3.78541):1)}\FPprint\amountg ~l}
\newcommand{\qttol}[1]{\FPeval\amountg{round((#1 * 0.94635295):1)}\FPprint\amountg ~l}
\newcommand{\oztoml}[1]{\FPeval\amountg{round((#1 * 29.5735):0)}\FPprint\amountg ~ml}
\newcommand{\cuptoml}[1]{\FPeval\amountg{round((#1 * 240.0):0)}\FPprint\amountg ~ml}
\newcommand{\tsptoml}[1]{\FPeval\amountg{round((#1 * 4.92892):0)}\FPprint\amountg ~ml}
\newcommand{\flakecuptog}[1]{\FPeval\amountg{round((#1 * 75.0):0)}\FPprint\amountg ~g}
\newcommand{\sugarcuptog}[1]{\FPeval\amountg{round((#1 * 225.0):0)}\FPprint\amountg ~g}
\newcommand{\srmtoebc}[1]{\FPeval\amountg{round((#1 * 1.97):0)}\FPprint\amountg ~EBC}
\newcommand{\ltoebc}[1]{\FPeval\amountg{round(((#1 * 2.65) - 1.2):0)}\FPprint\amountg ~EBC}
\newcommand{\ebctoebc}[1]{\FPeval\amountg{round((#1):0)}\FPprint\amountg ~EBC}
\newcommand{\sgtop}[1]{\FPeval\amountg{round((135.997 * pow(3,#1) - 630.272 * pow(2,#1) + 1111.14 * #1 - 616.868):1)}\FPprint\amountg ~°P}
\newcommand{\voltogl}[1]{\FPeval\amountg{round((#1 * 1.96):1)}\FPprint\amountg ~g/l}
\newcommand{\lboztokg}[2]{\FPeval\amountg{round((#1 * 0.4535924 + #2 * 28.34952 / 1000.0):2)}\FPprint\amountg ~kg}
\newcommand{\cacotohco}[1]{\FPeval\amountg{round((61.0 * #1 / 50.0):0)}\FPprint\amountg}

\newcommand{\specitem}[1]{\textcolor{black}{\uppercase{\textbf{#1}}}}

\newenvironment{malts} {\recipesection{images/malt.pdf}{Malt / Mash Additions}
\begin{tabu} to \textwidth {Xr}
\textbf{Name} & \textbf{Amount} \\ \midrule}{\end{tabu}}
\newcommand{\malt}[2]{#1 & #2 \\ \midrule}

\newenvironment{hops} {\recipesection{images/hop.pdf}{Hops / Boil Additions}
\begin{tabu} to \textwidth {Xcr}
\textbf{Name} & \textbf{Addition} & \textbf{Amount} \\ \midrule}{\end{tabu}
{\centering\small{FWP = first wort hopping, FO = flameout, WP = whirlpool, DHBT =
biotransformation, DH = dry hopping} \par}}
\newcommand{\hop}[4]{#1 \ifthenelse{\isempty{#2}}{}{(#2)} & \ifthenelse{\isempty{#3}}{--}{#3} & #4 \\ \midrule}

\newenvironment{yeastsx} {\recipesection{images/yeast.pdf}{Yeast}
\begin{tabu} to \textwidth {Xr}
\textbf{Name} & \textbf{Addition} \\ \midrule}{\end{tabu}}
\newcommand{\yeastx}[2]{#1 & #2 \\ \midrule}

\newenvironment{yeasts} {\recipesection{images/yeast.pdf}{Yeast}
\begin{tabu} to \textwidth {X}}{\end{tabu}}
\newcommand{\yeast}[1]{#1 \\ \midrule}

\newcommand{\singleyeast}[1]{
\begin{yeasts}
\yeast{#1}
\end{yeasts}
}

\newenvironment{twists} {\recipesection{images/star.pdf}{Fermentation Additons}
\begin{tabu} to \textwidth {Xcr}
\textbf{Name} & \textbf{Addition} & \textbf{Amount} \\ \midrule}{\end{tabu}}
\newcommand{\twist}[3]{#1 & \ifthenelse{\isempty{#2}}{--}{#2} & #3 \\ \midrule}

\newenvironment{mashsteps} {\recipesection{images/mash.pdf}{Mash}
\begin{tabu} to \textwidth {Xr}}{\end{tabu}}
\newcommand{\mashstep}[2]{#1 & #2 \\ \midrule}
\newcommand{\mashdecoctthin}[1]{\mashstep{}{Thin decoction #1}}
\newcommand{\mashdecoctthick}[1]{\mashstep{}{Thick decoction #1}}
\newcommand{\mashdecoctboil}[1]{\mashstep{\ftoc{212}}{Boil #1}}
\newcommand{\mashdecoctreturn}[2]{\mashstep{#1}{Return to main mash\ifthenelse{\isempty{#2}}{}{; #2}}}

\newenvironment{fermentationsteps} {\recipesection{images/ferment.pdf}{Fermentation} 
\begin{tabu} to \textwidth {Xr}}{\end{tabu}}
\newcommand{\fermentationstep}[2]{#1 & #2 \\ \midrule}

\newenvironment{directions} {\recipesection{images/bulp.pdf}{Directions}}{}

\newenvironment{methodandtiming} {\begin{recipeblock}{Method / Timings}}{\end{recipeblock}}

\newenvironment{yeastinfos}[1] {\begin{recipeblock}{#1} 
\begin{tabu} to \textwidth {lX}}{\end{tabu}
\end{recipeblock}}
\newcommand{\yeastinfo}[2]{#1 & #2 \\ \midrule}

\newenvironment{maltinfos}[1] {\begin{recipeblock}{#1} 
\begin{tabu} to \textwidth {Xrr}
\textbf{Name} & \textbf{Color Min} & \textbf{Color Max} \\ \midrule
}{\end{tabu}
\end{recipeblock}}
\newcommand{\maltinfo}[3]{#1 & #2 & #3 \\ \midrule}

\newcommand{\dryhbt}[2]{DHBT\ifthenelse{\isempty{#1}}{}{\textsubscript{#1}}\ifthenelse{\isempty{#2}}{}{ (#2)}}
\newcommand{\dryh}[2]{DH\ifthenelse{\isempty{#1}}{}{\textsubscript{#1}}\ifthenelse{\isempty{#2}}{}{ (#2)}}
\newcommand{\whirl}[2]{WP\ifthenelse{\isempty{#1}}{}{\textsubscript{#1}}\ifthenelse{\isempty{#2}}{}{ (#2)}}
\newcommand{\fwh}{FWH}
\newcommand{\foh}[1]{FO\ifthenelse{\isempty{#1}}{}{ (#1)}}

\newcommand{\hopahtanum}{Ahtanum}
\newcommand{\hopamarillo}{Amarillo}
\newcommand{\hopapollo}{Apollo}
\newcommand{\hoparamis}{Aramis}
\newcommand{\hopaurora}{Aurora}
\newcommand{\hopazacca}{Azacca}
\newcommand{\hopbramlingcross}{Bramling Cross}
\newcommand{\hopbravo}{Bravo}
\newcommand{\hopcalypso}{Calypso}
\newcommand{\hopcascade}{Cascade}
\newcommand{\hopceleia}{Celeia}
\newcommand{\hopcentennial}{Centennial}
\newcommand{\hopchallenger}{Challenger}
\newcommand{\hopchinook}{Chinook}
\newcommand{\hopcitra}{Citra}
\newcommand{\hopcolumbus}{Columbus}
\newcommand{\hopcomet}{Comet}
\newcommand{\hopcrystal}{Crystal}
\newcommand{\hopeastkentgolding}{East Kent Golding}
\newcommand{\hopekuanot}{Ekuanot}
\newcommand{\hopeldorado}{El Dorado}
\newcommand{\hopeureka}{Eureka}
\newcommand{\hopfalconersflight}{Falconer's Flight}
\newcommand{\hopfuggle}{Fuggle}
\newcommand{\hopgalaxy}{Galaxy}
\newcommand{\hopgalena}{Galena}
\newcommand{\hopglacier}{Glacier}
\newcommand{\hopgolding}{Golding}
\newcommand{\hophallertaublanc}{Hallertau Blanc}
\newcommand{\hophallertaumittelfruh}{Hallertau Mittelfrüh}
\newcommand{\hophallertautradition}{Hallertau Tradition}
\newcommand{\hopherkules}{Herkules}
\newcommand{\hophersbrucker}{Hersbrucker}
\newcommand{\hophorizon}{Horizon}
\newcommand{\hophullmelon}{Hüll Melon}
\newcommand{\hopidahoseven}{Idaho 7}
\newcommand{\hopkohatu}{Kohatu}
\newcommand{\hoplegacy}{Legacy}
\newcommand{\hoplemondrop}{Lemondrop}
\newcommand{\hopliberty}{Liberty}
\newcommand{\hoploral}{Loral}
\newcommand{\hoplubelska}{Lubelska}
\newcommand{\hopmagnum}{Magnum}
\newcommand{\hopmandarinabavaria}{Mandarina Bavaria}
\newcommand{\hopmarynka}{Marynka}
\newcommand{\hopmatueka}{Matueka}
\newcommand{\hopmillennium}{Millennium}
\newcommand{\hopmosaic}{Mosaic}
\newcommand{\hopmotueka}{Motueka}
\newcommand{\hopmthood}{Mt. Hood}
\newcommand{\hopnelsonsauvin}{Nelson Sauvin}
\newcommand{\hopnorthdown}{Northdown}
\newcommand{\hopnorthernbrewer}{Northern Brewer}
\newcommand{\hopnugget}{Nugget}
\newcommand{\hopopal}{Opal}
\newcommand{\hoppacifica}{Pacifica}
\newcommand{\hoppacificgem}{Pacific Gem}
\newcommand{\hoppacificjade}{Pacific Jade}
\newcommand{\hoppalisade}{Palisade}
\newcommand{\hopperle}{Perle}
\newcommand{\hoppolaris}{Polaris}
\newcommand{\hoprakau}{Rakau}
\newcommand{\hopsaaz}{Saaz}
\newcommand{\hopsantiam}{Santiam}
\newcommand{\hopsimcoe}{Simcoe}
\newcommand{\hopsorachiace}{Sorachi Ace}
\newcommand{\hopspalt}{Spalt}
\newcommand{\hopspaltselect}{Spalt Select}
\newcommand{\hopsterling}{Sterling}
\newcommand{\hopstrisselspalt}{Strisselspalt}
\newcommand{\hopstyriangolding}{Styrian Golding}
\newcommand{\hopsummit}{Summit}
\newcommand{\hoptarget}{Target}
\newcommand{\hoptettnang}{Tettnang}
\newcommand{\hopvanguard}{Vanguard}
\newcommand{\hopvicsecret}{Vic Secret}
\newcommand{\hopwakatu}{Wakatu}
\newcommand{\hopwarrior}{Warrior}
\newcommand{\hopwillamette}{Willamette}
\newcommand{\hopzythos}{Zythos}

% Light Lager
\newcommand{\styleamericanlightlager}{American Light Lager}
\newcommand{\styleamericanlager}{American Lager}
\newcommand{\styleinternationalpalelager}{International Pale Lager}
\newcommand{\stylemunichhelles}{Munich Helles}
\newcommand{\stylefestbier}{Festbier}
\newcommand{\stylegermanhellesexportbier}{German Helles Exportbier}

% Pilsner
\newcommand{\stylegermanleichtbier}{German Leichtbier}
\newcommand{\styleczechpalelager}{Czech Pale Lager}
\newcommand{\stylegermanpils}{German Pils}
\newcommand{\styleczechpremiumpalelager}{Czech Premium Pale Lager}

% European Amber Lager
\newcommand{\styleviennalager}{Vienna Lager}
\newcommand{\styleczechamberlager}{Czech Amber Lager}
\newcommand{\stylemarzen}{Märzen}
\newcommand{\stylekellerbier}{Kellerbier}

% Bock
\newcommand{\stylehellesbock}{Helles Bock}
\newcommand{\styledunklesbock}{Dunkles Bock}
\newcommand{\styledoppelbock}{Doppelbock}
\newcommand{\styleeisbock}{Eisbock}

% Dark Lager
\newcommand{\styleinternationaldarklager}{International Dark Lager}
\newcommand{\stylemunichdunkel}{Munich Dunkel}
\newcommand{\styleczechdarklager}{Czech Dark Lager}
\newcommand{\styleschwarzbier}{Schwarzbier}

% Light Hybrid Beer
\newcommand{\stylecreamale}{Cream Ale}
\newcommand{\styleblondeale}{Blonde Ale}
\newcommand{\stylekolsch}{Kölsch}
\newcommand{\styleamericanwheat}{American Wheat}

% Amber Hybrid Beer
\newcommand{\styleinternationalamberlager}{International Amber Lager}
\newcommand{\stylecaliforniacommon}{California Common}
\newcommand{\stylealtbier}{Altbier}

% English Pale Ale
\newcommand{\styleordinarybitter}{Ordinary Bitter}
\newcommand{\stylebestbitter}{Best Bitter}
\newcommand{\stylestrongbitter}{Strong Bitter}
\newcommand{\stylebritishgoldenale}{British Golden Ale}
\newcommand{\styleaustraliansparklingale}{Australian Sparkling Ale}

% Scottish & Irish Ale
\newcommand{\stylescottishlight}{Scottish Light}
\newcommand{\stylescottishheavy}{Scottish Heavy}
\newcommand{\stylescottishexport}{Scottish Export}
\newcommand{\styleirishredale}{Irish Red Ale}
\newcommand{\styleweeheavy}{Wee Heavy}

% American Pale Ale
\newcommand{\styleamericanpaleale}{American Pale Ale}

% Other American Ale
\newcommand{\styleamericanamberale}{American Amber Ale}
\newcommand{\styleamericanbrownale}{American Brown Ale}

% English Brown Ale
\newcommand{\styledarkmild}{Dark Mild}
\newcommand{\stylebritishbrownale}{British Brown Ale}

% Porter
\newcommand{\styleenglishporter}{English Porter}
\newcommand{\styleamericanporter}{American Porter}
\newcommand{\stylebalticporter}{Baltic Porter}

% Stout
\newcommand{\styleoatmealstout}{Oatmeal Stout}
\newcommand{\stylesweetstout}{Sweet Stout}

% Strong Stout
\newcommand{\styleamericanstout}{American Stout}
\newcommand{\styleimperialstout}{Imperial Stout}

% American IPA
\newcommand{\styleamericanipa}{American IPA}

% India Pale Ale
\newcommand{\englishipa}{English IPA}
\newcommand{\styleryeipa}{Specialty IPA: Rye IPA}

% German Wheat Rye Beer
\newcommand{\styleweissbier}{Weissbier}
\newcommand{\styledunklesweissbier}{Dunkles Weissbier}
\newcommand{\styleweizenbock}{Weizenbock}

% Belgian & French Al
\newcommand{\stylewitbier}{Witbier}
\newcommand{\stylebelgianpaleale}{Belgian Pale Ale}
\newcommand{\stylesaison}{Saison}

% Belgian Strong Ale
\newcommand{\stylebelgianblondale}{Belgian Blond Ale}
\newcommand{\stylebelgiandubbel}{Belgian Dubbel}
\newcommand{\stylebelgiantripel}{Belgian Tripel}
\newcommand{\stylebelgiangoldenstrongale}{Belgian Golden Strong Ale}
\newcommand{\stylebelgiandarkstrongale}{Belgian Dark Strong Ale}

% Strong Ale
\newcommand{\styleoldale}{Old Ale}
\newcommand{\styleenglishbarleywine}{English Barleywine}
\newcommand{\styleamericanbarleywine}{American Barleywine}

% Fruit Beer
\newcommand{\stylefruitbeer}{Fruit Beer}

% Spice / Herb / Vegetable Beer
\newcommand{\stylewinterseasonalbeer}{Winter Seasonal Beer}

% Smoke-Flavored & Wood-Aged Beer
\newcommand{\stylerauchbier}{Rauchbier}

% Specialty Beer
\newcommand{\stylealternativesugarbeer}{Alternative Sugar Beer}

\newcommand{\sourcehomebrewchallenge}{Source: The Homebrew Challenge.}
\newcommand{\sourceaha}{Source: American Homebrewers Association.}
\newcommand{\sourcezymurgy}[1]{Source: Zymurgy #1.}
\newcommand{\waterprofile}[6]{\ce{Ca} #1~ppm, \ce{Mg} #2~ppm, \ce{Na} #3~ppm, \ce{SO4} #4~ppm, \ce{Cl} #5~ppm\ifthenelse{\isempty{#6}}{}{, \ce{HCO3} #6~ppm}}

\newcommand{\specifications}[9]{
\begin{recipeblock}{Specifications}
\begin{tabu} to \textwidth {Xr}
\specitem{Style} & #1 \\ \midrule
\specitem{Volume} & #2 \\ \midrule
\specitem{Original Gravity} & \ifthenelse{\isempty{#3}}{--}{\sgtop{#3} / #3} \\ \midrule
\specitem{Final Gravity} & \ifthenelse{\isempty{#4}}{--}{\sgtop{#4} / #4} \\ \midrule
\specitem{ABV} & \ifthenelse{\isempty{#5}}{--}{#5} \\ \midrule
\specitem{Bitterness} & \ifthenelse{\isempty{#6}}{--}{\ibutoibu{#6}} \\ \midrule
\specitem{Color} & \ifthenelse{\isempty{#7}}{--}{#7} \\ \midrule
\specitem{Boil Time} & \ifthenelse{\isempty{#8}}{--}{#8} \\ \midrule
\specitem{Carbonation} & \ifthenelse{\isempty{#9}}{--}{\voltogl{#9} / #9~vol} \\ \midrule
\end{tabu}
\end{recipeblock}
}

\newgeometry{left=2.5cm,right=2.5cm,top=2.5cm,bottom=3cm}

\RedeclareSectionCommand[beforeskip=0mm,afterindent=false,afterskip=3mm]{chapter}
\RedeclareSectionCommand[afterindent=false,afterskip=0.5mm]{section}
\renewcommand*{\partpagestyle}{empty} 
